<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz SQL Multijoueur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #3a7bd5);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .difficulty-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            font-size: 0.9rem;
        }
        
        .difficulty-easy {
            background-color: #2ecc71;
        }
        
        .difficulty-medium {
            background-color: #f39c12;
        }
        
        .difficulty-hard {
            background-color: #e74c3c;
        }
        
        .difficulty-expert {
            background-color: #9b59b6;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }
        
        @media (max-width: 900px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* Panneau principal */
        .main-panel {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        /* Panneau latéral */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .panel {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .panel h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        /* État du jeu */
        .game-state {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .question-counter {
            font-size: 1.3rem;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 8px 15px;
            border-radius: 50px;
        }
        
        .timer {
            font-size: 2.2rem;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            margin-bottom: 10px;
        }
        
        /* Question */
        .question-container {
            margin-bottom: 30px;
        }
        
        .question-text {
            font-size: 1.4rem;
            line-height: 1.5;
            margin-bottom: 25px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .code-snippet {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            font-size: 1.1rem;
        }
        
        /* Options de réponse */
        .answer-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .answer-option {
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 18px 20px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .answer-option:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .answer-option.selected {
            background-color: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }
        
        .answer-option.correct {
            background-color: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }
        
        .answer-option.incorrect {
            background-color: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
        }
        
        /* Contrôles du jeu */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 14px 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }
        
        button#startGame {
            background-color: #2ecc71;
        }
        
        button#startGame:hover {
            background-color: #27ae60;
        }
        
        /* Classement */
        .players-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .player.me {
            background-color: rgba(52, 152, 219, 0.3);
            border: 1px solid #3498db;
        }
        
        .player-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .player-score {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .player-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .player-position {
            font-weight: bold;
            color: #ffcc00;
        }
        
        /* Résultats */
        .results-container {
            text-align: center;
        }
        
        .final-score {
            font-size: 3.5rem;
            font-weight: bold;
            color: #ffcc00;
            margin: 20px 0;
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
        }
        
        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .score-item {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
        }
        
        .score-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2ecc71;
        }
        
        /* Configuration du joueur */
        .player-setup input {
            width: 100%;
            padding: 14px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: none;
            background-color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }
        
        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .avatar-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .avatar-option:hover {
            transform: scale(1.1);
        }
        
        .avatar-option.selected {
            border: 3px solid #ffcc00;
            transform: scale(1.1);
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .main-panel, .panel {
                padding: 15px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .game-controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .question-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-database"></i> Quiz SQL Multijoueur</h1>
            <p class="subtitle">Affrontez d'autres joueurs en répondant à des questions SQL. Score basé sur la rapidité et l'exactitude.</p>
        </header>
        
        <div class="game-container">
            <!-- Panneau principal du jeu -->
            <div class="main-panel">
                <!-- État du jeu -->
                <div class="game-state">
                    <div class="question-header">
                        <div class="question-counter">Question <span id="currentQuestion">1</span> / <span id="totalQuestions">10</span></div>
                        <div id="difficultyDisplay" class="difficulty-indicator difficulty-easy">Facile</div>
                    </div>
                    <div class="timer" id="timer">30s</div>
                    <div id="gameStatus">En attente du début de la partie...</div>
                </div>
                
                <!-- Question -->
                <div class="question-container" id="questionContainer">
                    <div class="question-text" id="questionText">
                        Le jeu va commencer dès qu'un administrateur aura lancé la partie. Préparez-vous à répondre à des questions sur SQL !
                    </div>
                    <div class="code-snippet hidden" id="codeSnippet">
                        <!-- Le code SQL sera inséré ici -->
                    </div>
                </div>
                
                <!-- Options de réponse -->
                <div class="answer-options" id="answerOptions">
                    <!-- Les options de réponse seront insérées ici -->
                </div>
                
                <!-- Contrôles du jeu -->
                <div class="game-controls">
                    <button id="startGame">
                        <i class="fas fa-play"></i> Démarrer la partie
                    </button>
                    <button id="submitAnswer" disabled>
                        <i class="fas fa-paper-plane"></i> Soumettre la réponse
                    </button>
                    <button id="nextQuestion" disabled>
                        <i class="fas fa-forward"></i> Question suivante
                    </button>
                </div>
            </div>
            
            <!-- Panneau latéral -->
            <div class="sidebar">
                <!-- Classement des joueurs -->
                <div class="panel">
                    <h2><i class="fas fa-trophy"></i> Classement en temps réel</h2>
                    <div class="players-list" id="playersList">
                        <!-- Les joueurs seront ajoutés ici -->
                        <div class="player me">
                            <div class="player-name">
                                <div class="player-position">1</div>
                                <div class="player-avatar" style="background-color: #3498db;">VO</div>
                                <div>Vous</div>
                            </div>
                            <div class="player-score">0 pts</div>
                        </div>
                        <div class="player">
                            <div class="player-name">
                                <div class="player-position">2</div>
                                <div class="player-avatar" style="background-color: #e74c3c;">JD</div>
                                <div>Joueur 2</div>
                            </div>
                            <div class="player-score">0 pts</div>
                        </div>
                        <div class="player">
                            <div class="player-name">
                                <div class="player-position">3</div>
                                <div class="player-avatar" style="background-color: #2ecc71;">MJ</div>
                                <div>Joueur 3</div>
                            </div>
                            <div class="player-score">0 pts</div>
                        </div>
                    </div>
                </div>
                
                <!-- Configuration du joueur -->
                <div class="panel player-setup" id="playerSetup">
                    <h2><i class="fas fa-user"></i> Configuration du joueur</h2>
                    <input type="text" id="playerName" placeholder="Votre nom" maxlength="15" value="Joueur 1">
                    <p>Choisissez votre avatar :</p>
                    <div class="avatar-selection">
                        <div class="avatar-option selected" style="background-color: #3498db;" data-color="#3498db">VO</div>
                        <div class="avatar-option" style="background-color: #e74c3c;" data-color="#e74c3c">JD</div>
                        <div class="avatar-option" style="background-color: #2ecc71;" data-color="#2ecc71">MJ</div>
                        <div class="avatar-option" style="background-color: #9b59b6;" data-color="#9b59b6">AL</div>
                    </div>
                    <button id="savePlayerConfig">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
                
                <!-- Résultats finaux (caché au début) -->
                <div class="panel results-container hidden" id="resultsPanel">
                    <h2><i class="fas fa-chart-line"></i> Vos résultats</h2>
                    <div class="final-score" id="finalScore">0 pts</div>
                    <div class="score-breakdown">
                        <div class="score-item">
                            <div>Questions correctes</div>
                            <div class="score-value" id="correctAnswers">0/10</div>
                        </div>
                        <div class="score-item">
                            <div>Temps moyen</div>
                            <div class="score-value" id="averageTime">0s</div>
                        </div>
                        <div class="score-item">
                            <div>Score rapidité</div>
                            <div class="score-value" id="speedScore">0</div>
                        </div>
                        <div class="score-item">
                            <div>Position finale</div>
                            <div class="score-value" id="finalPosition">1er</div>
                        </div>
                    </div>
                    <button id="playAgain">
                        <i class="fas fa-redo"></i> Rejouer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Base de données de questions SQL avec niveaux de difficulté
        const questionDatabase = {
            easy: [
                {
                    question: "Quelle commande SQL est utilisée pour récupérer des données d'une base de données?",
                    code: null,
                    options: ["GET", "SELECT", "EXTRACT", "QUERY"],
                    correctAnswer: 1,
                    points: 100
                },
                {
                    question: "Quelle clause SQL est utilisée pour filtrer les résultats?",
                    code: null,
                    options: ["FILTER", "WHERE", "HAVING", "CONDITION"],
                    correctAnswer: 1,
                    points: 100
                },
                {
                    question: "Quelle commande est utilisée pour mettre à jour des données dans une table SQL?",
                    code: null,
                    options: ["MODIFY", "UPDATE", "CHANGE", "ALTER"],
                    correctAnswer: 1,
                    points: 100
                },
                {
                    question: "Quelle commande crée une nouvelle table dans une base de données?",
                    code: null,
                    options: ["CREATE TABLE", "ADD TABLE", "INSERT TABLE", "NEW TABLE"],
                    correctAnswer: 0,
                    points: 100
                },
                {
                    question: "Quelle commande est utilisée pour supprimer une table?",
                    code: null,
                    options: ["REMOVE TABLE", "DELETE TABLE", "DROP TABLE", "ERASE TABLE"],
                    correctAnswer: 2,
                    points: 100
                },
                {
                    question: "Comment ajouter une nouvelle ligne dans une table?",
                    code: null,
                    options: ["ADD ROW", "INSERT INTO", "CREATE ROW", "NEW ROW"],
                    correctAnswer: 1,
                    points: 100
                },
                {
                    question: "Quelle clause est utilisée pour trier les résultats?",
                    code: null,
                    options: ["SORT BY", "ORDER BY", "ARRANGE BY", "GROUP BY"],
                    correctAnswer: 1,
                    points: 100
                },
                {
                    question: "Quel mot-clé est utilisé pour éliminer les doublons?",
                    code: null,
                    options: ["UNIQUE", "DISTINCT", "DIFFERENT", "ONLY"],
                    correctAnswer: 1,
                    points: 100
                }
            ],
            medium: [
                {
                    question: "Quelle jointure retourne tous les enregistrements des deux tables?",
                    code: null,
                    options: ["INNER JOIN", "LEFT JOIN", "RIGHT JOIN", "FULL OUTER JOIN"],
                    correctAnswer: 3,
                    points: 150
                },
                {
                    question: "Quelle fonction agrège des valeurs numériques?",
                    code: null,
                    options: ["COUNT()", "AVG()", "MAX()", "Toutes ces réponses"],
                    correctAnswer: 3,
                    points: 150
                },
                {
                    question: "Que fait la clause GROUP BY?",
                    code: null,
                    options: ["Filtre les groupes", "Regroupe les lignes ayant des valeurs communes", "Trie les résultats par groupe", "Combine plusieurs tables"],
                    correctAnswer: 1,
                    points: 150
                },
                {
                    question: "Quelle est la différence entre WHERE et HAVING?",
                    code: null,
                    options: ["WHERE filtre avant regroupement, HAVING après", "HAVING filtre avant regroupement, WHERE après", "C'est la même chose", "WHERE pour jointures, HAVING pour sous-requêtes"],
                    correctAnswer: 0,
                    points: 150
                },
                {
                    question: "Quelle est la sortie de cette requête?",
                    code: "SELECT COUNT(*) FROM employees WHERE department = 'Sales';",
                    options: ["Le nombre total d'employés", "Le nombre d'employés dans le département Sales", "La somme des salaires du département Sales", "Une erreur car il manque GROUP BY"],
                    correctAnswer: 1,
                    points: 150
                },
                {
                    question: "Que fait cette requête?",
                    code: "DELETE FROM customers WHERE last_purchase < '2023-01-01';",
                    options: ["Supprime tous les clients", "Supprime les clients sans achat depuis 2023", "Met à jour la date du dernier achat", "Sélectionne les clients avec achat avant 2023"],
                    correctAnswer: 1,
                    points: 150
                },
                {
                    question: "Comment créer un index sur une colonne?",
                    code: null,
                    options: ["CREATE INDEX idx_name ON table(column)", "ADD INDEX idx_name ON table(column)", "MAKE INDEX idx_name FOR table(column)", "INDEX CREATE idx_name ON table(column)"],
                    correctAnswer: 0,
                    points: 150
                }
            ],
            hard: [
                {
                    question: "Quelle requête trouve les employés avec le salaire supérieur à la moyenne de leur département?",
                    code: null,
                    options: [
                        "SELECT * FROM employees WHERE salary > AVG(salary)",
                        "SELECT * FROM employees e1 WHERE salary > (SELECT AVG(salary) FROM employees e2 WHERE e2.department = e1.department)",
                        "SELECT * FROM employees GROUP BY department HAVING salary > AVG(salary)",
                        "SELECT * FROM employees WHERE salary > DEPARTMENT_AVG(salary)"
                    ],
                    correctAnswer: 1,
                    points: 200
                },
                {
                    question: "Que fait cette requête avec une CTE (Common Table Expression)?",
                    code: "WITH ranked_sales AS (SELECT *, ROW_NUMBER() OVER(PARTITION BY region ORDER BY sales DESC) as rank FROM sales_data) SELECT * FROM ranked_sales WHERE rank = 1;",
                    options: [
                        "Sélectionne toutes les ventes",
                        "Sélectionne les meilleures ventes par région",
                        "Calcule le total des ventes par région",
                        "Trie les ventes par ordre décroissant"
                    ],
                    correctAnswer: 1,
                    points: 200
                },
                {
                    question: "Comment optimiser cette requête lente?",
                    code: "SELECT * FROM orders WHERE YEAR(order_date) = 2023 AND MONTH(order_date) = 1;",
                    options: [
                        "Ajouter un index sur order_date",
                        "Utiliser: WHERE order_date >= '2023-01-01' AND order_date < '2023-02-01'",
                        "Les deux réponses ci-dessus",
                        "Remplacer * par les noms de colonnes spécifiques"
                    ],
                    correctAnswer: 2,
                    points: 200
                },
                {
                    question: "Quelle est la différence entre UNION et UNION ALL?",
                    code: null,
                    options: [
                        "UNION élimine les doublons, UNION ALL garde tous les enregistrements",
                        "UNION ALL élimine les doublons, UNION garde tous les enregistrements",
                        "UNION trie les résultats, UNION ALL non",
                        "UNION fonctionne avec JOIN, UNION ALL non"
                    ],
                    correctAnswer: 0,
                    points: 200
                },
                {
                    question: "Comment créer une vue qui se met à jour automatiquement?",
                    code: null,
                    options: [
                        "CREATE VIEW view_name AS SELECT ...",
                        "CREATE MATERIALIZED VIEW view_name AS SELECT ...",
                        "CREATE AUTO VIEW view_name AS SELECT ...",
                        "CREATE DYNAMIC VIEW view_name AS SELECT ..."
                    ],
                    correctAnswer: 0,
                    points: 200
                }
            ],
            expert: [
                {
                    question: "Comment optimiser une requête avec plusieurs LEFT JOIN sur de grandes tables?",
                    code: null,
                    options: [
                        "Utiliser INNER JOIN à la place",
                        "Ajouter des indexes appropriés sur les clés de jointure",
                        "Diviser la requête en plusieurs sous-requêtes",
                        "Toutes ces réponses peuvent être correctes selon le contexte"
                    ],
                    correctAnswer: 3,
                    points: 250
                },
                {
                    question: "Que fait cette requête avec une fenêtre (window function)?",
                    code: "SELECT employee_id, salary, SUM(salary) OVER(PARTITION BY department ORDER BY hire_date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) as running_total FROM employees;",
                    options: [
                        "Calcule le total des salaires par département",
                        "Calcule le total cumulé des salaires par département ordonné par date d'embauche",
                        "Trie les employés par salaire",
                        "Calcule la moyenne des salaires"
                    ],
                    correctAnswer: 1,
                    points: 250
                },
                {
                    question: "Comment gérer les deadlocks dans une base de données transactionnelle?",
                    code: null,
                    options: [
                        "Utiliser des transactions plus courtes",
                        "Accéder aux tables dans le même ordre",
                        "Utiliser le niveau d'isolation READ COMMITTED",
                        "Toutes ces réponses"
                    ],
                    correctAnswer: 3,
                    points: 250
                },
                {
                    question: "Quelle est la différence entre un index cluster et non-cluster?",
                    code: null,
                    options: [
                        "L'index cluster détermine l'ordre physique des données",
                        "L'index non-cluster est une copie séparée des données",
                        "On ne peut avoir qu'un seul index cluster par table",
                        "Toutes ces réponses"
                    ],
                    correctAnswer: 3,
                    points: 250
                },
                {
                    question: "Comment implémenter le pattern soft delete avec contrainte d'unicité?",
                    code: null,
                    options: [
                        "Ajouter une colonne 'deleted' et l'inclure dans la contrainte UNIQUE",
                        "Utiliser une vue qui filtre les enregistrements supprimés",
                        "Utiliser une table séparée pour les archives",
                        "Les trois réponses sont valables selon les besoins"
                    ],
                    correctAnswer: 3,
                    points: 250
                }
            ]
        };

        // Données du jeu
        const gameData = {
            playerName: "Joueur 1",
            playerAvatar: { text: "VO", color: "#3498db" },
            players: [
                { id: 1, name: "Vous", score: 0, avatar: { text: "VO", color: "#3498db" }, isCurrentPlayer: true },
                { id: 2, name: "Joueur 2", score: 0, avatar: { text: "JD", color: "#e74c3c" }, isCurrentPlayer: false },
                { id: 3, name: "Joueur 3", score: 0, avatar: { text: "MJ", color: "#2ecc71" }, isCurrentPlayer: false }
            ],
            currentQuestionIndex: 0,
            totalQuestions: 10,
            timePerQuestion: 30,
            timer: null,
            timeLeft: 30,
            gameStarted: false,
            selectedAnswer: null,
            playerAnswers: [],
            questions: [],
            currentDifficulty: 'easy',
            gameStats: {
                gamesPlayed: 0,
                totalScore: 0,
                bestScore: 0,
                averageScore: 0
            }
        };

        // Éléments DOM
        const elements = {
            currentQuestion: document.getElementById('currentQuestion'),
            totalQuestions: document.getElementById('totalQuestions'),
            timer: document.getElementById('timer'),
            gameStatus: document.getElementById('gameStatus'),
            questionText: document.getElementById('questionText'),
            codeSnippet: document.getElementById('codeSnippet'),
            answerOptions: document.getElementById('answerOptions'),
            startGame: document.getElementById('startGame'),
            submitAnswer: document.getElementById('submitAnswer'),
            nextQuestion: document.getElementById('nextQuestion'),
            playersList: document.getElementById('playersList'),
            playerSetup: document.getElementById('playerSetup'),
            resultsPanel: document.getElementById('resultsPanel'),
            playerName: document.getElementById('playerName'),
            savePlayerConfig: document.getElementById('savePlayerConfig'),
            playAgain: document.getElementById('playAgain'),
            finalScore: document.getElementById('finalScore'),
            correctAnswers: document.getElementById('correctAnswers'),
            averageTime: document.getElementById('averageTime'),
            speedScore: document.getElementById('speedScore'),
            finalPosition: document.getElementById('finalPosition'),
            difficultyDisplay: document.getElementById('difficultyDisplay')
        };

        // Initialisation du jeu
        function initGame() {
            // Configuration du joueur
            elements.savePlayerConfig.addEventListener('click', savePlayerConfig);
            
            // Configuration des avatars
            document.querySelectorAll('.avatar-option').forEach(avatar => {
                avatar.addEventListener('click', function() {
                    document.querySelectorAll('.avatar-option').forEach(a => a.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // Configuration des boutons du jeu
            elements.startGame.addEventListener('click', startGame);
            elements.submitAnswer.addEventListener('click', submitAnswer);
            elements.nextQuestion.addEventListener('click', nextQuestion);
            elements.playAgain.addEventListener('click', resetGame);
            
            // Charger les statistiques depuis le localStorage
            loadGameStats();
            
            // Générer des questions aléatoires
            generateRandomQuestions();
            
            // Mise à jour de l'affichage initial
            updatePlayersList();
            updateQuestionDisplay();
            elements.totalQuestions.textContent = gameData.totalQuestions;
        }

        // Générer des questions aléatoires avec progression de difficulté
        function generateRandomQuestions() {
            gameData.questions = [];
            const difficultyDistribution = [
                ...Array(4).fill('easy'),    // 4 questions faciles
                ...Array(3).fill('medium'),  // 3 questions moyennes
                ...Array(2).fill('hard'),    // 2 questions difficiles
                ...Array(1).fill('expert')   // 1 question experte
            ];
            
            difficultyDistribution.forEach(difficulty => {
                const questions = questionDatabase[difficulty];
                if (questions && questions.length > 0) {
                    // Sélectionner une question aléatoire non utilisée
                    const availableQuestions = questions.filter(q => 
                        !gameData.questions.some(existing => existing.question === q.question)
                    );
                    
                    if (availableQuestions.length > 0) {
                        const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                        gameData.questions.push(availableQuestions[randomIndex]);
                    } else {
                        // Si toutes les questions ont été utilisées, prendre une aléatoire
                        const randomIndex = Math.floor(Math.random() * questions.length);
                        gameData.questions.push(questions[randomIndex]);
                    }
                }
            });
            
            // Mélanger les questions pour éviter un ordre prévisible
            shuffleArray(gameData.questions);
        }

        // Fonction pour mélanger un tableau
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Sauvegarde de la configuration du joueur
        function savePlayerConfig() {
            const name = elements.playerName.value.trim() || "Joueur 1";
            gameData.playerName = name;
            
            const selectedAvatar = document.querySelector('.avatar-option.selected');
            const avatarText = selectedAvatar.textContent;
            const avatarColor = selectedAvatar.getAttribute('data-color');
            
            gameData.playerAvatar = { text: avatarText, color: avatarColor };
            
            // Mettre à jour le joueur actuel dans la liste
            const currentPlayer = gameData.players.find(p => p.isCurrentPlayer);
            if (currentPlayer) {
                currentPlayer.name = name;
                currentPlayer.avatar = { text: avatarText, color: avatarColor };
            }
            
            updatePlayersList();
            alert(`Configuration sauvegardée: ${name}`);
        }

        // Démarrage du jeu
        function startGame() {
            if (gameData.gameStarted) return;
            
            gameData.gameStarted = true;
            gameData.currentQuestionIndex = 0;
            gameData.playerAnswers = [];
            
            // Générer de nouvelles questions pour chaque partie
            generateRandomQuestions();
            
            elements.startGame.disabled = true;
            elements.submitAnswer.disabled = false;
            elements.nextQuestion.disabled = true;
            
            // Mettre à jour le statut
            elements.gameStatus.textContent = "La partie a commencé! Répondez rapidement!";
            
            // Démarrer la première question
            loadQuestion(gameData.currentQuestionIndex);
            startTimer();
            
            // Simuler d'autres joueurs qui répondent
            simulateOtherPlayers();
        }

        // Chargement d'une question
        function loadQuestion(index) {
            const question = gameData.questions[index];
            
            // Déterminer la difficulté pour l'affichage
            updateDifficultyDisplay(question);
            
            // Mettre à jour l'affichage de la question
            elements.currentQuestion.textContent = index + 1;
            elements.questionText.textContent = question.question;
            
            // Afficher ou masquer le snippet de code
            if (question.code) {
                elements.codeSnippet.textContent = question.code;
                elements.codeSnippet.classList.remove('hidden');
            } else {
                elements.codeSnippet.classList.add('hidden');
            }
            
            // Créer les options de réponse
            elements.answerOptions.innerHTML = '';
            question.options.forEach((option, i) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'answer-option';
                optionElement.textContent = option;
                optionElement.dataset.index = i;
                optionElement.addEventListener('click', () => selectAnswer(i));
                elements.answerOptions.appendChild(optionElement);
            });
            
            // Réinitialiser la sélection
            gameData.selectedAnswer = null;
            
            // Réinitialiser le timer
            gameData.timeLeft = gameData.timePerQuestion;
            elements.timer.textContent = `${gameData.timeLeft}s`;
        }

        // Mettre à jour l'affichage de la difficulté
        function updateDifficultyDisplay(question) {
            const difficultyClassMap = {
                100: 'difficulty-easy',
                150: 'difficulty-medium', 
                200: 'difficulty-hard',
                250: 'difficulty-expert'
            };
            
            const difficultyTextMap = {
                100: 'Facile',
                150: 'Moyen',
                200: 'Difficile',
                250: 'Expert'
            };
            
            elements.difficultyDisplay.textContent = difficultyTextMap[question.points] || 'Facile';
            elements.difficultyDisplay.className = `difficulty-indicator ${difficultyClassMap[question.points] || 'difficulty-easy'}`;
        }

        // Sélection d'une réponse
        function selectAnswer(index) {
            if (!gameData.gameStarted) return;
            
            // Désélectionner toutes les options
            document.querySelectorAll('.answer-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Sélectionner l'option choisie
            const selectedOption = document.querySelector(`.answer-option[data-index="${index}"]`);
            selectedOption.classList.add('selected');
            
            gameData.selectedAnswer = index;
        }

        // Soumission d'une réponse
        function submitAnswer() {
            if (!gameData.gameStarted || gameData.selectedAnswer === null) {
                alert("Veuillez sélectionner une réponse!");
                return;
            }
            
            // Arrêter le timer
            clearInterval(gameData.timer);
            
            // Enregistrer la réponse du joueur
            const question = gameData.questions[gameData.currentQuestionIndex];
            const isCorrect = gameData.selectedAnswer === question.correctAnswer;
            const timeUsed = gameData.timePerQuestion - gameData.timeLeft;
            
            gameData.playerAnswers.push({
                questionIndex: gameData.currentQuestionIndex,
                selectedAnswer: gameData.selectedAnswer,
                isCorrect: isCorrect,
                timeUsed: timeUsed,
                points: calculatePoints(isCorrect, timeUsed, question.points)
            });
            
            // Mettre à jour le score du joueur
            const currentPlayer = gameData.players.find(p => p.isCurrentPlayer);
            if (currentPlayer) {
                currentPlayer.score += gameData.playerAnswers[gameData.playerAnswers.length - 1].points;
            }
            
            // Afficher la réponse correcte
            highlightCorrectAnswer(question.correctAnswer);
            
            // Désactiver le bouton de soumission
            elements.submitAnswer.disabled = true;
            
            // Activer le bouton question suivante
            elements.nextQuestion.disabled = false;
            
            // Mettre à jour le classement
            updatePlayersList();
            
            // Mettre à jour le statut
            if (isCorrect) {
                elements.gameStatus.textContent = `Correct! +${gameData.playerAnswers[gameData.playerAnswers.length - 1].points} points`;
            } else {
                elements.gameStatus.textContent = "Incorrect. La bonne réponse est mise en évidence.";
            }
        }

        // Calcul des points avec bonus de difficulté
        function calculatePoints(isCorrect, timeUsed, basePoints) {
            if (!isCorrect) return 0;
            
            let points = basePoints;
            
            // Bonus pour la rapidité (max 50 points)
            const timeBonus = Math.max(0, 50 - Math.floor(timeUsed / gameData.timePerQuestion * 50));
            points += timeBonus;
            
            // Bonus pour les questions difficiles
            if (basePoints >= 200) {
                points += 20; // Bonus supplémentaire pour les questions difficiles
            }
            
            return points;
        }

        // Mise en évidence de la bonne réponse
        function highlightCorrectAnswer(correctIndex) {
            document.querySelectorAll('.answer-option').forEach((option, index) => {
                if (index === correctIndex) {
                    option.classList.add('correct');
                } else if (index === gameData.selectedAnswer && index !== correctIndex) {
                    option.classList.add('incorrect');
                }
                
                // Désactiver les clics
                option.style.pointerEvents = 'none';
            });
        }

        // Passage à la question suivante
        function nextQuestion() {
            gameData.currentQuestionIndex++;
            
            if (gameData.currentQuestionIndex < gameData.totalQuestions) {
                // Charger la question suivante
                loadQuestion(gameData.currentQuestionIndex);
                
                // Réactiver le bouton de soumission
                elements.submitAnswer.disabled = false;
                
                // Désactiver le bouton question suivante
                elements.nextQuestion.disabled = true;
                
                // Réinitialiser le statut
                elements.gameStatus.textContent = "Répondez rapidement!";
                
                // Démarrer le timer
                startTimer();
            } else {
                // Fin du jeu
                endGame();
            }
        }

        // Démarrage du timer
        function startTimer() {
            clearInterval(gameData.timer);
            
            gameData.timer = setInterval(() => {
                gameData.timeLeft--;
                elements.timer.textContent = `${gameData.timeLeft}s`;
                
                if (gameData.timeLeft <= 0) {
                    clearInterval(gameData.timer);
                    
                    // Si le joueur n'a pas répondu, considérer comme incorrect
                    if (gameData.selectedAnswer === null) {
                        const question = gameData.questions[gameData.currentQuestionIndex];
                        gameData.playerAnswers.push({
                            questionIndex: gameData.currentQuestionIndex,
                            selectedAnswer: null,
                            isCorrect: false,
                            timeUsed: gameData.timePerQuestion,
                            points: 0
                        });
                        
                        // Afficher la bonne réponse
                        highlightCorrectAnswer(question.correctAnswer);
                        
                        // Désactiver le bouton de soumission
                        elements.submitAnswer.disabled = true;
                        
                        // Activer le bouton question suivante
                        elements.nextQuestion.disabled = false;
                        
                        // Mettre à jour le statut
                        elements.gameStatus.textContent = "Temps écoulé! La bonne réponse est mise en évidence.";
                    }
                }
            }, 1000);
        }

        // Fin du jeu
        function endGame() {
            clearInterval(gameData.timer);
            
            gameData.gameStarted = false;
            gameData.gameStats.gamesPlayed++;
            
            // Calculer les résultats
            const correctAnswers = gameData.playerAnswers.filter(a => a.isCorrect).length;
            const totalTime = gameData.playerAnswers.filter(a => a.isCorrect).reduce((sum, a) => sum + a.timeUsed, 0);
            const averageTime = correctAnswers > 0 ? Math.round(totalTime / correctAnswers) : 0;
            const speedScore = gameData.playerAnswers.reduce((sum, a) => sum + (a.isCorrect ? (gameData.timePerQuestion - a.timeUsed) : 0), 0);
            const totalScore = gameData.playerAnswers.reduce((sum, a) => sum + a.points, 0);
            
            // Mettre à jour les statistiques
            gameData.gameStats.totalScore += totalScore;
            gameData.gameStats.averageScore = Math.round(gameData.gameStats.totalScore / gameData.gameStats.gamesPlayed);
            if (totalScore > gameData.gameStats.bestScore) {
                gameData.gameStats.bestScore = totalScore;
            }
            
            // Sauvegarder les statistiques
            saveGameStats();
            
            // Mettre à jour l'affichage des résultats
            elements.finalScore.textContent = `${totalScore} pts`;
            elements.correctAnswers.textContent = `${correctAnswers}/${gameData.totalQuestions}`;
            elements.averageTime.textContent = `${averageTime}s`;
            elements.speedScore.textContent = speedScore;
            
            // Déterminer la position finale
            const sortedPlayers = [...gameData.players].sort((a, b) => b.score - a.score);
            const playerPosition = sortedPlayers.findIndex(p => p.isCurrentPlayer) + 1;
            elements.finalPosition.textContent = `${playerPosition}${getPositionSuffix(playerPosition)}`;
            
            // Afficher le panneau des résultats
            elements.resultsPanel.classList.remove('hidden');
            
            // Mettre à jour le statut avec les statistiques
            elements.gameStatus.textContent = `Jeu terminé! Meilleur score: ${gameData.gameStats.bestScore} pts | Moyenne: ${gameData.gameStats.averageScore} pts`;
            
            // Désactiver les boutons
            elements.submitAnswer.disabled = true;
            elements.nextQuestion.disabled = true;
            elements.startGame.disabled = false;
        }

        // Réinitialisation du jeu
        function resetGame() {
            // Réinitialiser les données du jeu
            gameData.currentQuestionIndex = 0;
            gameData.playerAnswers = [];
            gameData.timeLeft = gameData.timePerQuestion;
            gameData.selectedAnswer = null;
            
            // Réinitialiser les scores des joueurs
            gameData.players.forEach(player => {
                player.score = 0;
            });
            
            // Générer de nouvelles questions aléatoires
            generateRandomQuestions();
            
            // Réinitialiser l'affichage
            updateQuestionDisplay();
            updatePlayersList();
            
            // Cacher le panneau des résultats
            elements.resultsPanel.classList.add('hidden');
            
            // Réactiver le bouton de démarrage
            elements.startGame.disabled = false;
            
            // Mettre à jour le statut
            elements.gameStatus.textContent = `Prêt pour une nouvelle partie! Parties jouées: ${gameData.gameStats.gamesPlayed}`;
            elements.timer.textContent = `${gameData.timeLeft}s`;
        }

        // Mise à jour de l'affichage de la question
        function updateQuestionDisplay() {
            elements.currentQuestion.textContent = 1;
            elements.questionText.textContent = "Le jeu va commencer dès que vous cliquerez sur 'Démarrer la partie'. Préparez-vous à répondre à des questions sur SQL!";
            elements.codeSnippet.classList.add('hidden');
            elements.difficultyDisplay.textContent = "Facile";
            elements.difficultyDisplay.className = "difficulty-indicator difficulty-easy";
            
            // Réinitialiser les options de réponse
            elements.answerOptions.innerHTML = '';
            
            // Réinitialiser le timer
            elements.timer.textContent = `${gameData.timePerQuestion}s`;
        }

        // Mise à jour de la liste des joueurs
        function updatePlayersList() {
            elements.playersList.innerHTML = '';
            
            // Trier les joueurs par score
            const sortedPlayers = [...gameData.players].sort((a, b) => b.score - a.score);
            
            // Afficher chaque joueur
            sortedPlayers.forEach((player, index) => {
                const playerElement = document.createElement('div');
                playerElement.className = `player ${player.isCurrentPlayer ? 'me' : ''}`;
                
                playerElement.innerHTML = `
                    <div class="player-name">
                        <div class="player-position">${index + 1}</div>
                        <div class="player-avatar" style="background-color: ${player.avatar.color};">${player.avatar.text}</div>
                        <div>${player.name}</div>
                    </div>
                    <div class="player-score">${player.score} pts</div>
                `;
                
                elements.playersList.appendChild(playerElement);
            });
        }

        // Simulation d'autres joueurs (pour la démonstration)
        function simulateOtherPlayers() {
            if (!gameData.gameStarted) return;
            
            // Simuler des réponses des autres joueurs toutes les 5-15 secondes
            const otherPlayers = gameData.players.filter(p => !p.isCurrentPlayer);
            
            otherPlayers.forEach(player => {
                const delay = Math.random() * 10000 + 5000; // 5-15 secondes
                
                setTimeout(() => {
                    if (gameData.gameStarted && gameData.currentQuestionIndex < gameData.totalQuestions) {
                        // Donner une réponse aléatoire avec probabilité ajustée selon la difficulté
                        const question = gameData.questions[gameData.currentQuestionIndex];
                        const basePoints = question.points;
                        const difficultyFactor = basePoints / 100; // 1 pour facile, 2.5 pour expert
                        const correctProbability = Math.max(0.3, 0.7 / difficultyFactor); // Moins de chances de réussir les questions difficiles
                        
                        const isCorrect = Math.random() < correctProbability;
                        const answerIndex = isCorrect ? question.correctAnswer : Math.floor(Math.random() * question.options.length);
                        const timeUsed = Math.floor(Math.random() * gameData.timePerQuestion * 0.8); // Les autres joueurs sont généralement plus lents
                        
                        // Ajouter des points aléatoires
                        player.score += calculatePoints(isCorrect, timeUsed, question.points);
                        
                        // Mettre à jour l'affichage
                        updatePlayersList();
                    }
                }, delay);
            });
            
            // Continuer la simulation si le jeu est toujours en cours
            if (gameData.gameStarted) {
                setTimeout(simulateOtherPlayers, 10000);
            }
        }

        // Sauvegarder les statistiques dans localStorage
        function saveGameStats() {
            localStorage.setItem('sqlQuizStats', JSON.stringify(gameData.gameStats));
        }

        // Charger les statistiques depuis localStorage
        function loadGameStats() {
            const savedStats = localStorage.getItem('sqlQuizStats');
            if (savedStats) {
                gameData.gameStats = JSON.parse(savedStats);
            }
        }

        // Obtenir le suffixe de position (1er, 2ème, etc.)
        function getPositionSuffix(position) {
            if (position === 1) return "er";
            return "ème";
        }

        // Initialiser le jeu au chargement de la page
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
